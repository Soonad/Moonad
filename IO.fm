T IO (A: Type)
| end(val: A);
| log(str: String, nxt: Unit -> IO(A));
| get(nxt: String -> IO(A));

IO.query(str: String): IO(String)
  IO.log<String>(str, () IO.get<String>(IO.end<String>))

IO.print(str: String): IO(Unit)
  use skip = IO.log<Unit>(str)
  IO.end<Unit>(Unit.new)

IO.bind<A: Type, B: Type>(a: IO(A), f: A -> IO(B)) : IO(B)
  case a:
  | f(a.val);
  | IO.log<B>(a.str, (x) IO.bind<A,B>(a.nxt(x), f));
  | IO.get<B>((x) IO.bind<A,B>(a.nxt(x), f));
